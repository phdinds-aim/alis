
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Counting Ones in a Window &#8212; ALIS: Algorithmic Library for Scalability  documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=4fea3ae4a0a4ba949df0a89bbae557cc2ce861ae" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom-style.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"TeX": {"equationNumbers": {"autoNumber": "AMS", "useLabelIds": true}}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Most Common Recent Elements" href="common-recent.html" />
    <link rel="prev" title="Moments" href="moments.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">ALIS: Algorithmic Library for Scalability  documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../introduction.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../installation.html">
   Installation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contents
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../finding-similar-items/index.html">
   Finding Similar Items
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../finding-similar-items/set-similarity.html">
     Set Similarity
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../finding-similar-items/shingling.html">
     Shingling of Documents
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../finding-similar-items/minhashing.html">
     Minhashing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../finding-similar-items/introduction-to-lsh.html">
     Locality Sensitive Hashing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../finding-similar-items/theory-of-lsf.html">
     Theory of LSF
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../finding-similar-items/lsh-for-minhash.html">
     LSH Banding Technique
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../finding-similar-items/the-lsh-class.html">
     Many-to-Many Document Similarity Task
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../finding-similar-items/demo-minhash-lsh.html">
     LSH and Document Similarity
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Stream Mining
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="stream-data-model.html">
     Stream Data Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="data-stream.html">
     Sampling Data in a Stream
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="filtering-stream.html">
     Filtering Streams
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="counting-distinct.html">
     Counting Distinct Elements in a Stream
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="moments.html">
     Moments
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Counting Ones in a Window
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="common-recent.html">
     Most Common Recent Elements
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../link-analysis/index.html">
   Link Analysis
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../link-analysis/pagerank.html">
     PageRank
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../link-analysis/pagerank-for-large-data.html">
     PageRank for Large Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../link-analysis/pagerank-mapreduce.html">
     PageRank using MapReduce
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../link-analysis/topic-sensitive-pagerank.html">
     Topic-Sensitive PageRank
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../link-analysis/hubs-and-authorities.html">
     Hubs and Authorities
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../social-network-graphs/index.html">
   Social Network Graphs
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../social-network-graphs/social-network-preliminaries.html">
     What is a Social Network?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../social-network-graphs/network-measures.html">
     Network Measures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../social-network-graphs/community-detection.html">
     Community Detection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../social-network-graphs/social-network-analysis-using-graphframes.html">
     Social Network Analysis using GraphFrames
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bibliography.html">
   Bibliography
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  API Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../api-docs/feature_extraction/index.html">
   Feature Extraction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../api-docs/feature_extraction/shingles.html">
     Shingles
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api-docs/feature_extraction/minhash.html">
     Minhashing
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../api-docs/similarity/index.html">
   Similarity
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../api-docs/similarity/minhash_lsh.html">
     Minhash LSH
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api-docs/similarity/jaccard.html">
     Jaccard Similarity
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api-docs/stream_mining/index.html">
   Stream Mining
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api-docs/link_analysis/index.html">
   Link Analysis
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../api-docs/network_tools/index.html">
   Network Tools
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../api-docs/network_tools/clustering.html">
     Clustering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api-docs/network_tools/metrics.html">
     Metrics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../api-docs/network_tools/plots.html">
     Plots
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/stream-mining/counting-ones.ipynb.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#datar-gionis-indyk-motwani-algorithm">
   Datar-Gionis-Indyk-Motwani Algorithm
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#updating-buckets-with-new-data">
   Updating Buckets with New Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#error-bounds">
   Error Bounds
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise">
     Exercise
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Counting Ones in a Window</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#datar-gionis-indyk-motwani-algorithm">
   Datar-Gionis-Indyk-Motwani Algorithm
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#updating-buckets-with-new-data">
   Updating Buckets with New Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#error-bounds">
   Error Bounds
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise">
     Exercise
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="counting-ones-in-a-window">
<h1>Counting Ones in a Window<a class="headerlink" href="#counting-ones-in-a-window" title="Permalink to this headline">#</a></h1>
<p>Suppose we have a bit stream window of length <span class="math notranslate nohighlight">\(N\)</span> and we want to count the number of ones in the last <span class="math notranslate nohighlight">\(k\)</span> bits. Again assume that <span class="math notranslate nohighlight">\(k\)</span> is too large so we cannot afford to store it all <span class="math notranslate nohighlight">\(k\)</span> bits in memory, as would be needed to get an exact count. We can use the Datar-Gionis-Indyk-Motwani (DGIM) algorithm to approximate the count with an error rate of no greater than 50%.</p>
<section id="datar-gionis-indyk-motwani-algorithm">
<h2>Datar-Gionis-Indyk-Motwani Algorithm<a class="headerlink" href="#datar-gionis-indyk-motwani-algorithm" title="Permalink to this headline">#</a></h2>
<p>Assume we have a bit stream window of ‘10101100111011011000101110110010110’. We give each bit a timestamp starting with 1 for the earliest bit, 2 for the 2nd bit, and so on. We divide the bits into <em>buckets</em> consisting of:</p>
<ol class="simple">
<li><p>The timestamp of its most rightmost (most recent) end.</p></li>
<li><p>The number of ones in the bucket. This number must be a power of 2, and we refer to this as the <em>size</em> of the bucket.</p></li>
</ol>
<p>Furthermore, the buckets of the bit stream have to follow the following rules:</p>
<ol class="simple">
<li><p>The right end of a bucket is always a bit with a value 1.</p></li>
<li><p>Every bit with a value of 1 is in some bucket.</p></li>
<li><p>No bit is in more than one bucket.</p></li>
<li><p>There are just one or two buckets of any given size.</p></li>
<li><p>All sizes must be a power of 2.</p></li>
<li><p>Buckets cannot decrease in size as we move to the left.</p></li>
</ol>
<p>Once we’ve split the bit stream into buckets, we can now estimate the number of 1’s for any <span class="math notranslate nohighlight">\(k\)</span> in the window. Find the bucket <span class="math notranslate nohighlight">\(b\)</span> with the earliest timestamp that includes some of the <span class="math notranslate nohighlight">\(k\)</span> most recent bits. The estimate of the number of ones is the sum of the sizes of all buckets to the right of <span class="math notranslate nohighlight">\(b\)</span>, plus half the size of <span class="math notranslate nohighlight">\(b\)</span> itself.</p>
<p>For example, take the stream above having the buckets as shown and with <span class="math notranslate nohighlight">\(k=10\)</span>. We want to get the count of ones in the 10 rightmost bits, or 0110010110. The bucket with size 4 containing ‘11101’ is the earliest bucket which contains the at least some of last <span class="math notranslate nohighlight">\(k\)</span> bits. We take half the size of this bucket, which equals to 2, plus the sizes of the buckets to the right, so 2, 1, and 1. The DGIM estimate for the number of ones is therefore <span class="math notranslate nohighlight">\(2+2+1+1=6\)</span>, which is close to the actual answer of 5.</p>
<p>Let’s try another example, this time counting the ones in the last <strong>20</strong> elements of bit stream …100011101011010001110111101000001010101001000000000100101001100, divided into the following buckets:</p>
<a class="reference internal image-reference" href="../_images/BitBuckets2.png"><img alt="../_images/BitBuckets2.png" src="../_images/BitBuckets2.png" style="width: 700px;" /></a>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bitStream</span> <span class="o">=</span> <span class="s1">&#39;100011101011010001110111101000001010101001000000000100101001100&#39;</span>

<span class="n">k</span><span class="o">=</span><span class="mi">20</span> <span class="c1">#Count ones in last k=20 elements</span>
<span class="n">buckets</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">buckets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">buckets</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">buckets</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">buckets</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">buckets</span><span class="p">[</span><span class="mi">24</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">buckets</span><span class="p">[</span><span class="mi">36</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">buckets</span><span class="p">[</span><span class="mi">41</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">buckets</span><span class="p">[</span><span class="mi">56</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>

<span class="n">earliestBucket</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">approxCount</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">buckets</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ts</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
        <span class="k">continue</span>
        
    <span class="k">if</span> <span class="n">earliestBucket</span><span class="p">:</span>
        <span class="n">approxCount</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">buckets</span><span class="p">[</span><span class="n">ts</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">earliestBucket</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">approxCount</span> <span class="o">+=</span> <span class="n">buckets</span><span class="p">[</span><span class="n">ts</span><span class="p">]</span>
        
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Approx Count&#39;</span><span class="p">,</span> <span class="n">approxCount</span><span class="p">)</span>

<span class="n">realCount</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">bitStream</span><span class="p">[</span><span class="o">-</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
        <span class="n">realCount</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Real Count&#39;</span><span class="p">,</span> <span class="n">realCount</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="updating-buckets-with-new-data">
<h2>Updating Buckets with New Data<a class="headerlink" href="#updating-buckets-with-new-data" title="Permalink to this headline">#</a></h2>
<p>When a new data comes in from the stream, we may need to update the buckets in a way that everything will still follow the DGIM conditions. When a new bit enters, we take the following steps:</p>
<ol class="simple">
<li><p>Check the leftmost bucket. If the timestamp has has gone past the our window of length <span class="math notranslate nohighlight">\(N\)</span>,remove it from the list of buckets we are tracking.</p></li>
<li><p>If the new bit is 0, we do not need to do anything.</p></li>
<li><p>If the new bit is 1, we first create a new bucket of size 1 containing the new bit. If there was only one bucket of size 1, then nothing more needs to be done.</p></li>
<li><p>If there are now 3 buckets of size 1, we combine the 2 leftmost buckets of size into one bucket of size 2.</p></li>
<li><p>Do step #4 repeatedly for the buckets with sizes greater than 1 until all the buckets follow the DGIM rules once again.</p></li>
</ol>
<a class="reference internal image-reference" href="../_images/BitBuckets2Add.png"><img alt="../_images/BitBuckets2Add.png" src="../_images/BitBuckets2Add.png" style="width: 700px;" /></a>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">60</span>

<span class="c1">#Existing bucket groupings</span>
<span class="n">buckets</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">buckets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">buckets</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">buckets</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">buckets</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">buckets</span><span class="p">[</span><span class="mi">24</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">buckets</span><span class="p">[</span><span class="mi">36</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">buckets</span><span class="p">[</span><span class="mi">41</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">buckets</span><span class="p">[</span><span class="mi">56</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>


<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">buckets</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span> <span class="c1">#add all existing buckets back with their rightmost index incremented by 1</span>
    <span class="k">if</span> <span class="n">key</span><span class="o">+</span><span class="mi">1</span> <span class="o">&gt;</span> <span class="n">N</span><span class="p">:</span> <span class="c1">#No need to add if bucket is now out of window</span>
        <span class="k">continue</span>
        
    <span class="n">buckets</span><span class="p">[</span><span class="n">key</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">buckets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">buckets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

<span class="n">buckets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#create a new bucket of size 1 containing the new bit</span>

<span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">16</span><span class="p">]:</span>
    <span class="n">buckets_</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">buckets</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="o">==</span><span class="n">size</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">buckets_</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">max_bucket</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">buckets_</span><span class="p">)</span>
        <span class="n">buckets</span><span class="p">[</span><span class="n">max_bucket</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="o">*</span><span class="mi">2</span>
        
    <span class="k">continue</span>
    
    <span class="n">sizeCount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sizeIndexes</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">buckets</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">buckets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="n">size</span><span class="p">:</span>
            <span class="n">sizeCount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">sizeIndexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">buckets</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">:</span>
            <span class="k">break</span>
    
    <span class="c1">#Only need to do something if more than 2 buckets have the same size</span>
    <span class="k">if</span> <span class="n">sizeCount</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">newSize</span> <span class="o">=</span> <span class="n">size</span> <span class="o">*</span> <span class="mi">2</span>
        
        <span class="c1">#combine the 2 leftmost buckets of the same size into one bucket of twice the size.</span>
        <span class="n">buckets</span><span class="p">[</span><span class="n">sizeIndexes</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">newSize</span>
        <span class="k">del</span> <span class="n">buckets</span><span class="p">[</span><span class="n">sizeIndexes</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

    
<span class="nb">print</span><span class="p">(</span><span class="n">buckets</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{57: 16, 42: 8, 37: 8, 25: 4, 12: 4, 7: 2, 4: 2, 3: 1, 0: 1}
</pre></div>
</div>
</div>
</div>
</section>
<section id="error-bounds">
<h2>Error Bounds<a class="headerlink" href="#error-bounds" title="Permalink to this headline">#</a></h2>
<p>Suppose that the exact count is <span class="math notranslate nohighlight">\(c\)</span>, and the DGIM estimate involves a leftmost bucket <span class="math notranslate nohighlight">\(b\)</span> of size <span class="math notranslate nohighlight">\(2^j\)</span>. We consider 2 error cases separately, one where the estimate is larger than <span class="math notranslate nohighlight">\(c\)</span> and one where the estimate is smaller than <span class="math notranslate nohighlight">\(c\)</span>.</p>
<ol class="simple">
<li><p>The estimate is smaller than <span class="math notranslate nohighlight">\(c\)</span>. The worst case scenario is all the 1’s in <span class="math notranslate nohighlight">\(b\)</span> should have been part of the count, and using only <span class="math notranslate nohighlight">\(\frac{1}{2}\)</span> of the size of <span class="math notranslate nohighlight">\(b\)</span> only gives us <span class="math notranslate nohighlight">\(2^{j-1}\)</span> 1’s. However <span class="math notranslate nohighlight">\(c\)</span> should be at least <span class="math notranslate nohighlight">\(2^{j+1}-1\)</span>. Thereforce we conclude that our estimate is at least 50% of <span class="math notranslate nohighlight">\(c\)</span>.</p></li>
<li><p>The estimate is larger than <span class="math notranslate nohighlight">\(c\)</span>. The worst case scenario is only the rightmost bit of bucket <span class="math notranslate nohighlight">\(b\)</span> is included, and there is only one bucket of each of the sizes smaller than <span class="math notranslate nohighlight">\(b\)</span>. Then <span class="math notranslate nohighlight">\(c = 1+2^{j−1} +2^{j−2} +···+1=2^j\)</span>, and the estimate we get from DGIM is <span class="math notranslate nohighlight">\(2^{j−1} + 2^{j−1} + 2^{j−2} + · · · + 1 = 2^j + 2^{j−1} − 1\)</span>. Therefor we can conclude that the estimate is no more than 50% greater of <span class="math notranslate nohighlight">\(c\)</span>.</p></li>
</ol>
<p>We can improve the error bounds further by replacing the condition that there can only be 1 or 2 buckets for each size, with instead there being <span class="math notranslate nohighlight">\(r\)</span> or <span class="math notranslate nohighlight">\(r-1\)</span> buckets for each size with <span class="math notranslate nohighlight">\(r &gt; 2\)</span>.</p>
<section id="exercise">
<h3>Exercise<a class="headerlink" href="#exercise" title="Permalink to this headline">#</a></h3>
<ol class="simple">
<li><p>What would be the placements of buckets for bit stream “011100010101110000110110110” ?</p></li>
</ol>
</section>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="moments.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Moments</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="common-recent.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Most Common Recent Elements</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By AIM PhD in DS 2024<br/>
  
      &copy; Copyright 2022, AIM PhD in DS 2024.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>